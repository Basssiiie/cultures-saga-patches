
from utils.executable import Executable
from utils.patch import Patch


class AssistantLimits(Patch):
	def apply(self, exe: Executable) -> None:
		limits = [
			# UserInput_Save():
			# push 20 -> 100 at
			(0x18b84, [0x6a, 0x14], "PUSH 0x64"),

			# Assistant_DoWork():
			# Remove cap of 100 requested males
			(0x17877, [0x83, 0xf9, 0x64, 0x89, 0x4e, 0x20, 0x7c, 0x03, 0x6a, 0x64, 0x59], "NOP\n" * 11),
			# Remove cap of 100 requested females
			(0x1788f, [0x6a, 0x14, 0x5b, 0x3b, 0xcb, 0x89, 0x4e, 0x24, 0x7c, 0x02, 0x8b, 0xcb], "NOP\n" * 12),
			# Remove cap of 80 requested soldiers
			(0x178a8, [0x83, 0xff, 0x50, 0x89, 0x7e, 0x28, 0x7c, 0x03, 0x6a, 0x50, 0x5f], "NOP\n" * 11),
			# Remove cap of 20 requested spearmen
			(0x178c3, [0x3b, 0xd3, 0x89, 0x56, 0x2c, 0x7c, 0x02, 0x8b, 0xd3], "NOP\n" * 9),
			# Remove cap of 20 requested archers
			(0x178d8, [0x3b, 0xcb, 0x89, 0x4e, 0x30, 0x7c, 0x02, 0x8b, 0xcb], "NOP\n" * 9),
			# Remove cap of 20 requested swordmen
			(0x178ed, [0x83, 0xf8, 0x14, 0x89, 0x46, 0x34, 0x7c, 0x03, 0x6a, 0x14, 0x58], "NOP\n" * 11),

			# Request more males if needed for soldiers every 3 minutes -> 5 seconds
			(0x177ab, [0xb9, 0xb4, 0x00, 0x00, 0x00], "MOV ECX, 0x5"),
			# Execute request baby every 15 -> 5 seconds (~3 times as fast)
			(0x178fe, [0x6a, 0x0f], "PUSH 0x5"),
		]

		for limit in limits:
			address, expected, replacement = limit
			exe.verify_and_replace(address, expected, replacement)
